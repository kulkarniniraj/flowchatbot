---

title: Title


keywords: fastai
sidebar: home_sidebar



nb_path: "oil-crm.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: oil-crm.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>The autoreload extension is already loaded. To reload it, use:
  %reload_ext autoreload
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">flowchatbot</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">flowchatbot</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_fn</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;splitter decider&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;s4&#39;</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">tryint</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;s4&#39;</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">10000</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">infodecider</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
<span class="c1">#     print(f&#39;decider {data}&#39;)</span>
    <span class="n">val</span> <span class="o">=</span> <span class="n">get_chained_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;ss1&#39;</span><span class="p">,</span> <span class="s1">&#39;c2&#39;</span><span class="p">,</span> <span class="s1">&#39;s3&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">val</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="mi">1</span>
<span class="k">def</span> <span class="nf">send_otp</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;mobile data </span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bot</span> <span class="o">=</span> <span class="n">TextAdapter</span><span class="p">(</span>
    <span class="n">Composite</span><span class="p">(</span>
        <span class="s1">&#39;c1&#39;</span><span class="p">,</span>
        <span class="n">Segment</span><span class="p">(</span><span class="s1">&#39;s0&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;welcome to The Imperial Lubricants&#39;</span><span class="p">),</span>
        <span class="n">Segment</span><span class="p">(</span><span class="s1">&#39;s1&#39;</span><span class="p">,</span> <span class="s1">&#39;please register your mobile no.&#39;</span><span class="p">,</span> <span class="s1">&#39;Thank you&#39;</span><span class="p">,</span> 
                <span class="n">on_answer</span><span class="o">=</span><span class="n">send_otp</span><span class="p">),</span>
        <span class="n">Segment</span><span class="p">(</span><span class="s1">&#39;s2&#39;</span><span class="p">,</span> <span class="s1">&#39;please enter OTP sent to your mobile no.&#39;</span><span class="p">,</span> <span class="s1">&#39;Thank you&#39;</span><span class="p">),</span>
        <span class="n">MultiChoiceSegment</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">,</span> <span class="s1">&#39;please choose option no.&#39;</span><span class="p">,</span> <span class="p">[</span> 
            <span class="s1">&#39;to purchase / order oil&#39;</span><span class="p">,</span>
            <span class="s1">&#39;for enquiry of product&#39;</span><span class="p">,</span>
            <span class="s1">&#39;for complaints&#39;</span><span class="p">,</span>
            <span class="s1">&#39;for cash back&#39;</span><span class="p">,</span>
            <span class="s1">&#39;for dealership&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;other&#39;</span><span class="p">],</span> <span class="s1">&#39;thank you&#39;</span><span class="p">)))</span>
<span class="n">bot</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">flushall</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>True</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">bot</span><span class="o">.</span><span class="n">respond</span><span class="p">(</span><span class="s1">&#39;hi&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>composite answer current s0 data {&#39;pos&#39;: &#39;s0&#39;}
composite question current s1 data {&#39;pos&#39;: &#39;s1&#39;, &#39;s0&#39;: {&#39;data&#39;: &#39;hi&#39;}}
adapter data {&#39;pos&#39;: &#39;s1&#39;, &#39;s0&#39;: {&#39;data&#39;: &#39;hi&#39;}, &#39;s1&#39;: {}}
welcome to The Imperial Lubricants
please register your mobile no.
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">bot</span><span class="o">.</span><span class="n">respond</span><span class="p">(</span><span class="s1">&#39;1234&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>composite answer current s1 data {&#39;pos&#39;: &#39;s1&#39;, &#39;s0&#39;: {&#39;data&#39;: &#39;hi&#39;}, &#39;s1&#39;: {}}
mobile data {&#39;data&#39;: &#39;1234&#39;}
composite question current s2 data {&#39;pos&#39;: &#39;s2&#39;, &#39;s0&#39;: {&#39;data&#39;: &#39;hi&#39;}, &#39;s1&#39;: {&#39;data&#39;: &#39;1234&#39;}}
adapter data {&#39;pos&#39;: &#39;s2&#39;, &#39;s0&#39;: {&#39;data&#39;: &#39;hi&#39;}, &#39;s1&#39;: {&#39;data&#39;: &#39;1234&#39;}, &#39;s2&#39;: {}}
Thank you
please enter OTP sent to your mobile no.
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">bot</span><span class="o">.</span><span class="n">respond</span><span class="p">(</span><span class="s1">&#39;1234&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>composite answer current s2 data {&#39;pos&#39;: &#39;s2&#39;, &#39;s0&#39;: {&#39;data&#39;: &#39;hi&#39;}, &#39;s1&#39;: {&#39;data&#39;: &#39;1234&#39;}, &#39;s2&#39;: {}}
composite question current s3 data {&#39;pos&#39;: &#39;s3&#39;, &#39;s0&#39;: {&#39;data&#39;: &#39;hi&#39;}, &#39;s1&#39;: {&#39;data&#39;: &#39;1234&#39;}, &#39;s2&#39;: {&#39;data&#39;: &#39;1234&#39;}}
adapter data {&#39;pos&#39;: &#39;s3&#39;, &#39;s0&#39;: {&#39;data&#39;: &#39;hi&#39;}, &#39;s1&#39;: {&#39;data&#39;: &#39;1234&#39;}, &#39;s2&#39;: {&#39;data&#39;: &#39;1234&#39;}, &#39;s3&#39;: {}}
Thank you
please choose option no.
1. to purchase / order oil
2. for enquiry of product
3. for complaints
4. for cash back
5. for dealership
6. other
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">bot</span><span class="o">.</span><span class="n">respond</span><span class="p">(</span><span class="s1">&#39;8&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>composite answer current s3 data {&#39;pos&#39;: &#39;s3&#39;, &#39;s0&#39;: {&#39;data&#39;: &#39;hi&#39;}, &#39;s1&#39;: {&#39;data&#39;: &#39;1234&#39;}, &#39;s2&#39;: {&#39;data&#39;: &#39;1234&#39;}, &#39;s3&#39;: {}}
composite question current s3 data {&#39;pos&#39;: &#39;s3&#39;, &#39;s0&#39;: {&#39;data&#39;: &#39;hi&#39;}, &#39;s1&#39;: {&#39;data&#39;: &#39;1234&#39;}, &#39;s2&#39;: {&#39;data&#39;: &#39;1234&#39;}, &#39;s3&#39;: {}}
adapter data {&#39;pos&#39;: &#39;s3&#39;, &#39;s0&#39;: {&#39;data&#39;: &#39;hi&#39;}, &#39;s1&#39;: {&#39;data&#39;: &#39;1234&#39;}, &#39;s2&#39;: {&#39;data&#39;: &#39;1234&#39;}, &#39;s3&#39;: {}}
Please enter one of 1..6 as answer
please choose option no.
1. to purchase / order oil
2. for enquiry of product
3. for complaints
4. for cash back
5. for dealership
6. other
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">bot</span><span class="o">.</span><span class="n">respond</span><span class="p">(</span><span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>composite answer current s3 data {&#39;pos&#39;: &#39;s3&#39;, &#39;s0&#39;: {&#39;data&#39;: &#39;hi&#39;}, &#39;s1&#39;: {&#39;data&#39;: &#39;1234&#39;}, &#39;s2&#39;: {&#39;data&#39;: &#39;1234&#39;}, &#39;s3&#39;: {}}
composite question current s0 data {&#39;s0&#39;: {&#39;data&#39;: &#39;hi&#39;}, &#39;s1&#39;: {&#39;data&#39;: &#39;1234&#39;}, &#39;s2&#39;: {&#39;data&#39;: &#39;1234&#39;}, &#39;s3&#39;: {&#39;data&#39;: (1, &#39;for enquiry of product&#39;)}, &#39;pos&#39;: &#39;s0&#39;}
adapter data {&#39;s0&#39;: {&#39;data&#39;: &#39;hi&#39;}, &#39;s1&#39;: {&#39;data&#39;: &#39;1234&#39;}, &#39;s2&#39;: {&#39;data&#39;: &#39;1234&#39;}, &#39;s3&#39;: {&#39;data&#39;: (1, &#39;for enquiry of product&#39;)}, &#39;pos&#39;: &#39;s0&#39;}
thank you

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span>        <span class="n">SkipSplitter</span><span class="p">(</span><span class="s1">&#39;ss1&#39;</span><span class="p">,</span> 
                    <span class="n">Composite</span><span class="p">(</span><span class="s1">&#39;c2&#39;</span><span class="p">,</span> 
                        <span class="n">Segment</span><span class="p">(</span><span class="s1">&#39;s1&#39;</span><span class="p">,</span> <span class="s1">&#39;your name&#39;</span><span class="p">,</span> <span class="s1">&#39;got it&#39;</span><span class="p">),</span>
                        <span class="n">ValidatedSegment</span><span class="p">(</span><span class="s1">&#39;s2&#39;</span><span class="p">,</span> <span class="s1">&#39;your mobile&#39;</span><span class="p">,</span> <span class="s1">&#39;got it&#39;</span><span class="p">,</span> <span class="s1">&#39;10 digit mobile&#39;</span><span class="p">,</span>
                                    <span class="n">valid_fn</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;(\+91)?\d</span><span class="si">{10}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">),</span>
                        <span class="n">ValidatedSegment</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">,</span> <span class="s1">&#39;your email&#39;</span><span class="p">,</span> <span class="s1">&#39;got it&#39;</span><span class="p">,</span> <span class="s1">&#39;email in format abc@qwe.zxc&#39;</span><span class="p">,</span>
                                    <span class="n">valid_fn</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;[a-zA-Z0-9._]+@[a-zA-Z0-9_]+\.[a-zA-Z0-9._]+&#39;</span><span class="p">,</span> 
                                                                <span class="n">x</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="p">),</span>
                    <span class="n">decider_fn</span><span class="o">=</span> <span class="n">infodecider</span><span class="p">),</span>
        <span class="n">Segment</span><span class="p">(</span><span class="s1">&#39;s4&#39;</span><span class="p">,</span> <span class="s1">&#39;your income&#39;</span><span class="p">,</span> <span class="s1">&#39;ok&#39;</span><span class="p">),</span>
        <span class="n">Splitter</span><span class="p">(</span><span class="s1">&#39;s5&#39;</span><span class="p">,</span> 
                <span class="n">Segment</span><span class="p">(</span><span class="s1">&#39;s51&#39;</span><span class="p">,</span> <span class="s1">&#39;Do you have bike?&#39;</span><span class="p">,</span> <span class="s1">&#39;ok&#39;</span><span class="p">),</span>
                <span class="n">Segment</span><span class="p">(</span><span class="s1">&#39;s52&#39;</span><span class="p">,</span> <span class="s1">&#39;Do you have car?&#39;</span><span class="p">,</span> <span class="s1">&#39;ok&#39;</span><span class="p">),</span>
                <span class="n">decider_fn</span><span class="o">=</span><span class="n">test_fn</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">bot</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">flushall</span><span class="p">()</span>

<span class="n">bot</span><span class="o">.</span><span class="n">respond</span><span class="p">(</span><span class="s1">&#39;hi&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;asd&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>asd
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">dir</span><span class="p">(</span><span class="n">flowchatbot</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;__builtins__&#39;,
 &#39;__cached__&#39;,
 &#39;__doc__&#39;,
 &#39;__file__&#39;,
 &#39;__loader__&#39;,
 &#39;__name__&#39;,
 &#39;__package__&#39;,
 &#39;__path__&#39;,
 &#39;__spec__&#39;,
 &#39;__version__&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

